const appPrefix = "bookany",
  slug = window.bookany.slug,
  side = window.bookany.side ?? "left",
  site_url = "http://localhost:3000",
  bookingIframeUrl = `${site_url}/${slug}/booking?shared`,
  giftIframeUrl = `${site_url}/${slug}/gift?shared`;
function initScript() {
  slug || console.log("slug is not defined");
  const e = document.createElement("div");
  (e.id = `${appPrefix}-sidebar`),
    document.body.appendChild(e),
    (e.style.width = "100vw"),
    (e.style.height = "100dvh"),
    (e.style.backgroundColor = "rgb(0, 0, 0, 0.5)"),
    (e.style.position = "fixed"),
    (e.style.top = "0px"),
    (e.style.left = "0px"),
    (e.style.zIndex = "1000000"),
    (e.style.display = "flex"),
    (e.style.alignItems = "center"),
    (e.style.transition = "opacity 0.3s ease-in-out"),
    (e.style.pointerEvents = "none"),
    (e.style.opacity = 0),
    (e.style.justifyContent = "left" === side ? "flex-start" : "flex-end");
  const t = document.createElement("iframe");
  (t.id = `${appPrefix}-iframe`),
    (t.src = bookingIframeUrl),
    (t.style.minWidth = "450px"),
    (t.style.border = "none"),
    (t.style.height = "100vh"),
    (t.style.height = "100vh"),
    (t.style.maxHeight = "-webkit-fill-available"),
    (t.style.transition = "transform 0.3s ease-in-out"),
    (t.style.transform = `translateX(${"left" === side ? "-100%" : "100%"})`),
    e.appendChild(t);
}
function updateIframe(e = "booking") {
  document.getElementById(`${appPrefix}-iframe`).src =
    "booking" === e ? bookingIframeUrl : giftIframeUrl;
}
function captureResizeScreen() {
  window.addEventListener("resize", function () {
    const e = document.getElementById(`${appPrefix}-iframe`);
    if (e) {
      const t = window.innerWidth > 600;
      e.style.width = t ? "450px" : "100vw";
    }
  });
}
function openContent(e = "booking") {
  const t = document.getElementById(`${appPrefix}-sidebar`);
  updateIframe(e);
  const n = document.getElementById(`${appPrefix}-iframe`);
  "0" === t.style.opacity
    ? ((t.style.opacity = 1), (t.style.pointerEvents = "auto"))
    : ((t.style.opacity = 0), (t.style.pointerEvents = "none")),
    n.style.transform.includes("100%")
      ? (n.style.transform = "translateX(0px)")
      : (n.style.transform = `translateX(${
          "left" === side ? "-100%" : "100%"
        })`);
}
function clickBackground() {
  document
    .getElementById(`${appPrefix}-sidebar`)
    .addEventListener("click", function () {
      toggleBooking("booking");
    });
}
initScript(),
  captureResizeScreen(),
  clickBackground(),
  (window.toggleBooking = () => openContent("booking")),
  (window.toggleGift = () => openContent("gift"));
